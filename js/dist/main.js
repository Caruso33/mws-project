"use strict";var map,restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[],lazyImages=[],logging=!1;document.addEventListener("DOMContentLoaded",function(e){serviceWorker(),fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){window.localforage.getItem("restaurantData",function(e,t){t?self.restaurantList=t:DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1});google.maps.event.addListenerOnce(self.map,"idle",function(){var e=document.querySelector("iframe");e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex","-1")});updateRestaurants()};var updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,s=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,s,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap(),lazyLoadImages()},createRestaurantHTML=function(e){var t=document.createElement("li"),n=document.createElement("figure"),r=document.createElement("img"),a=document.createElement("figcaption");n.className="restaurant-fig",r.className="restaurant-img",a.className="restaurant-figcap";var s=DBHelper.imageUrlForRestaurant(e);r.src="",r.alt="An impression of restaurant "+e.name,a.innerHTML="Restaurant "+e.name;var o=s.slice(0,-17);r["data-src"]=o+".webp",r["data-srcset"]=o+"-250_small-min.webp 250w,\n                  "+o+"-400_medium-min.webp 400w",r.sizes="(min-width: 434px) 300px, calc(100% - 137px)",n.append(r),n.append(a),t.append(n);var i=document.createElement("h2");i.innerHTML=e.name,t.append(i);var c=document.createElement("p");c.innerHTML=e.neighborhood,t.append(c);var l=document.createElement("p");l.innerHTML=e.address,t.append(l);var u=document.createElement("a");return u.innerHTML="View Details",u.href=DBHelper.urlForRestaurant(e),u.setAttribute("role","button"),u.setAttribute("aria-label","Press to view details of restaurant "+e.name),t.append(u),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},lazyLoadImages=function(){var e=[].slice.call(document.querySelectorAll(".restaurant-img"));if("IntersectionObserver"in window){var n=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.src=t["data-src"],t.srcset=t["data-srcset"],n.unobserve(t)}})});e.forEach(function(e){n.observe(e)})}else console.log("LazyLoadImages failed")},serviceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){logging&&console.log("[ServiceWorker] registered")}).catch(function(e){return console.log("[ServiceWorker] registration failed!",e)})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInNlcnZpY2VXb3JrZXIiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJ3aW5kb3ciLCJsb2NhbGZvcmFnZSIsImdldEl0ZW0iLCJlcnIiLCJyZXN0YXVyYW50TGlzdCIsIkRCSGVscGVyIiwiZXJyb3IiLCJzZWxmIiwiY29uc29sZSIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsIm5laWdoYm9yaG9vZCIsImNyZWF0ZUVsZW1lbnQiLCJvcHRpb24iLCJ2YWx1ZSIsImZldGNoQ3Vpc2luZXMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwiY3Vpc2luZSIsImFwcGVuZCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJ6b29tIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJhZGRMaXN0ZW5lck9uY2UiLCJjZW50ZXIiLCJxdWVyeVNlbGVjdG9yIiwiaWZyYW1lIiwic2V0QXR0cmlidXRlIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInVsIiwiaW5uZXJIVE1MIiwibWFya2VycyIsInNldE1hcCIsIm0iLCJyZXN0YXVyYW50IiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJsaSIsImZpZ2NhcCIsImZpZyIsImltYWdlIiwiY2xhc3NOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwibmFtZSIsInBsYWNlaG9sZGVySW1nIiwic2xpY2UiLCJyYXdJbWciLCJzaXplcyIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsInB1c2giLCJsYXp5TG9hZEltYWdlcyIsImxhenlJbWFnZXMiLCJjYWxsIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwib2JzZXJ2ZXIiLCJsYXp5SW1hZ2UiLCJzcmNzZXQiLCJsYXp5SW1hZ2VPYnNlcnZlciIsInVub2JzZXJ2ZSIsImVudHJ5IiwidGFyZ2V0Iiwic3JjIiwib2JzZXJ2ZSIsImxvZyIsIm5hdmlnYXRvciIsInJlZ2lzdGVyIiwic2NvcGUiLCJ0aGVuIiwicmVnIiwibG9nZ2luZyIsImNhdGNoIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUNBLElBQUlBLElBQUFBLGlCQUFBQSxFQUFhQyxtQkFBQUEsRUFBZUMsY0FBQUEsRUFBZkQsUUFBQUEsR0FBZUMsV0FBQUEsR0FDNUJDLFNBQUosRUFLQUMsU0FBQUMsaUJBQUEsbUJBQUEsU0FBQUMsR0FJRUMsZ0JBQ0FDLHFCQUZGSixrQkFNQSxJQUFBSSxtQkFBQSxXQUlFQyxPQUFPQyxZQUFZQyxRQUFRLGlCQUFrQixTQUFTQyxFQUFLQyxHQUNyREEsRUFGRkwsS0FBQUEsZUFBcUJLLEVBRXZCQyxTQUFJRCxtQkFBZ0IsU0FBQUUsRUFBQWQsR0FDYlksRUFFTEMsUUFBU04sTUFBQUEsSUFFTFEsS0FBQWYsY0FBQUEsRUFDQWdCLDhCQVVWQyxzQkFBQSxXQUFBLElBQUFqQixFQUFBLEVBQUFrQixVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBQUgsS0FBQWYsY0FJUXFCLEVBQVNsQixTQUFTbUIsZUFBZSx3QkFDdkN0QixFQUFjdUIsUUFBUSxTQUFBQyxHQUZsQlAsSUFBQUEsRUFBQUEsU0FBd0JRLGNBQXhCUixVQUFnRVMsRUFBdkMxQixVQUF1Q3dCLEVBS2xFRSxFQUFPQyxNQUFRSCxFQUpqQkgsRUFBTUEsT0FBU2xCLE1BRGpCeUIs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RixjQUFhVSxXQUNiOEUsVUFBQXhGLGVBRUF3RixVQUFBeEYsY0FDQXlGLFNBQUEscUJBQUEsQ0FBQUMsTUFBQSxNQUNBQyxLQUFBLFNBQUFDLEdBQ0FDLFNBQUFuRixRQUFBNkUsSUFBQSxnQ0FLRE8sTUFBTSxTQUFBekYsR0FBQSxPQUFPSyxRQUFRNkUsSUFBSSx1Q0FBd0NsRiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5sZXQgcmVzdGF1cmFudHMsIG5laWdoYm9yaG9vZHMsIGN1aXNpbmVzO1xyXG52YXIgbWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG52YXIgbGF6eUltYWdlcyA9IFtdO1xyXG5jb25zdCBsb2dnaW5nID0gZmFsc2U7XHJcblxyXG4vKipcclxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXHJcbiAqL1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZXZlbnQgPT4ge1xyXG4gIHNlcnZpY2VXb3JrZXIoKTtcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICB3aW5kb3cubG9jYWxmb3JhZ2UuZ2V0SXRlbSgncmVzdGF1cmFudERhdGEnLCBmdW5jdGlvbihlcnIsIHJlc3RhdXJhbnRMaXN0KSB7XHJcbiAgICBpZiAocmVzdGF1cmFudExpc3QpIHtcclxuICAgICAgc2VsZi5yZXN0YXVyYW50TGlzdCA9IHJlc3RhdXJhbnRMaXN0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgLy8gR290IGFuIGVycm9yXHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcclxuICAgICAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuY29uc3QgZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblxyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBsZXQgbG9jID0ge1xyXG4gICAgbGF0OiA0MC43MjIyMTYsXHJcbiAgICBsbmc6IC03My45ODc1MDFcclxuICB9O1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuICBjb25zdCBpZGxlTGlzdGVuZXIgPSBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lck9uY2UoXHJcbiAgICBzZWxmLm1hcCxcclxuICAgICdpZGxlJyxcclxuICAgICgpID0+IHtcclxuICAgICAgbGV0IGlmcmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpO1xyXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XHJcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XHJcbiAgICB9XHJcbiAgKTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcclxuICAgIGN1aXNpbmUsXHJcbiAgICBuZWlnaGJvcmhvb2QsXHJcbiAgICAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICApO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbmNvbnN0IHJlc2V0UmVzdGF1cmFudHMgPSByZXN0YXVyYW50cyA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNvbnN0IGZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG4gIH0pO1xyXG4gIGFkZE1hcmtlcnNUb01hcCgpO1xyXG4gIGxhenlMb2FkSW1hZ2VzKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmNvbnN0IGNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gcmVzdGF1cmFudCA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICBjb25zdCBmaWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWd1cmUnKTtcclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGNvbnN0IGZpZ2NhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ2NhcHRpb24nKTtcclxuXHJcbiAgZmlnLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWZpZyc7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICBmaWdjYXAuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtZmlnY2FwJztcclxuXHJcbiAgY29uc3QgcGxhY2Vob2xkZXJJbWcgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2Uuc3JjID0gJyc7XHJcbiAgaW1hZ2UuYWx0ID0gYEFuIGltcHJlc3Npb24gb2YgcmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX1gO1xyXG4gIGZpZ2NhcC5pbm5lckhUTUwgPSBgUmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX1gO1xyXG5cclxuICAvLyBzcmNzZXQ6IHNlcnZpbmcgdGhlIHJpZ2h0IGltZyBzaXplIHRvIHRoZSByaWdodCB2aWV3cG9ydCB3aWR0aFxyXG4gIGNvbnN0IHJhd0ltZyA9IHBsYWNlaG9sZGVySW1nLnNsaWNlKDAsIC0xNyk7XHJcbiAgaW1hZ2VbJ2RhdGEtc3JjJ10gPSBgJHtyYXdJbWd9LndlYnBgO1xyXG4gIGltYWdlWydkYXRhLXNyY3NldCddID0gYCR7cmF3SW1nfS0yNTBfc21hbGwtbWluLndlYnAgMjUwdyxcclxuICAgICAgICAgICAgICAgICAgJHtyYXdJbWd9LTQwMF9tZWRpdW0tbWluLndlYnAgNDAwd2A7XHJcbiAgaW1hZ2Uuc2l6ZXMgPSBgKG1pbi13aWR0aDogNDM0cHgpIDMwMHB4LCBjYWxjKDEwMCUgLSAxMzdweClgO1xyXG5cclxuICBmaWcuYXBwZW5kKGltYWdlKTtcclxuICBmaWcuYXBwZW5kKGZpZ2NhcCk7XHJcbiAgbGkuYXBwZW5kKGZpZyk7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xyXG4gIG1vcmUuc2V0QXR0cmlidXRlKFxyXG4gICAgJ2FyaWEtbGFiZWwnLFxyXG4gICAgYFByZXNzIHRvIHZpZXcgZGV0YWlscyBvZiByZXN0YXVyYW50ICR7cmVzdGF1cmFudC5uYW1lfWBcclxuICApO1xyXG5cclxuICBsaS5hcHBlbmQobW9yZSk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxufTtcclxuLy8gTGF6eSBsb2FkaW5nIGZvciBpbWFnZXMgYXMgZnJvbTpcclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vd2ViL2Z1bmRhbWVudGFscy9wZXJmb3JtYW5jZS9sYXp5LWxvYWRpbmctZ3VpZGFuY2UvaW1hZ2VzLWFuZC12aWRlby9cclxuY29uc3QgbGF6eUxvYWRJbWFnZXMgPSAoKSA9PiB7XHJcbiAgY29uc3QgbGF6eUltYWdlcyA9IFtdLnNsaWNlLmNhbGwoXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVzdGF1cmFudC1pbWcnKVxyXG4gICk7XHJcbiAgaWYgKCdJbnRlcnNlY3Rpb25PYnNlcnZlcicgaW4gd2luZG93KSB7XHJcbiAgICBsZXQgbGF6eUltYWdlT2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24oXHJcbiAgICAgIGVudHJpZXMsXHJcbiAgICAgIG9ic2VydmVyXHJcbiAgICApIHtcclxuICAgICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcclxuICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcclxuICAgICAgICAgIGxldCBsYXp5SW1hZ2UgPSBlbnRyeS50YXJnZXQ7XHJcbiAgICAgICAgICBsYXp5SW1hZ2Uuc3JjID0gbGF6eUltYWdlWydkYXRhLXNyYyddO1xyXG4gICAgICAgICAgbGF6eUltYWdlLnNyY3NldCA9IGxhenlJbWFnZVsnZGF0YS1zcmNzZXQnXTtcclxuICAgICAgICAgIGxhenlJbWFnZU9ic2VydmVyLnVub2JzZXJ2ZShsYXp5SW1hZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBsYXp5SW1hZ2VzLmZvckVhY2gobGF6eUltYWdlID0+IHtcclxuICAgICAgbGF6eUltYWdlT2JzZXJ2ZXIub2JzZXJ2ZShsYXp5SW1hZ2UpO1xyXG4gICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnNvbGUubG9nKCdMYXp5TG9hZEltYWdlcyBmYWlsZWQnKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBjb25zdCBsYXp5TG9hZEdvb2dsZU1hcCA9ICgpID0+IHtcclxuLy8gICBjb25zdCBsYXp5TWFwID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjbWFwJykpO1xyXG4vL1xyXG4vLyAgIGlmICgnSW50ZXJzZWN0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xyXG4vLyAgICAgbGV0IGxhenlHb29nbGVNYXBPYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihmdW5jdGlvbihcclxuLy8gICAgICAgZW50cmllcyxcclxuLy8gICAgICAgb2JzZXJ2ZXJcclxuLy8gICAgICkge1xyXG4vLyAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xyXG4vLyAgICAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykge1xyXG4vLyAgICAgICAgICAgbGV0IGxhenlHb29nbGVNYXAgPSBlbnRyeS50YXJnZXQ7XHJcbi8vICAgICAgICAgICBpbml0aWFsaXplTWFwKCk7XHJcbi8vICAgICAgICAgICBsYXp5TWFwT2JzZXJ2ZXIudW5vYnNlcnZlKGxhenlHb29nbGVNYXApO1xyXG4vLyAgICAgICAgIH1cclxuLy8gICAgICAgfSk7XHJcbi8vICAgICB9KTtcclxuLy8gICAgIGxhenlNYXAuZm9yRWFjaChtYXAgPT4ge1xyXG4vLyAgICAgICBsYXp5TWFwT2JzZXJ2ZXIub2JzZXJ2ZShtYXApO1xyXG4vLyAgICAgfSk7XHJcbi8vICAgfSBlbHNlIHtcclxuLy8gICAgIC8vIFBvc3NpYmx5IGZhbGwgYmFjayB0byBhIG1vcmUgY29tcGF0aWJsZSBtZXRob2QgaGVyZVxyXG4vLyAgICAgY29uc29sZS5sb2coJ0xhenlMb2FkR29vZ2xlTWFwcyBmYWlsZWQnKTtcclxuLy8gICB9XHJcbi8vIH07XHJcblxyXG4vKipcclxuICogQWRkIHNlcnZpY2Utd29ya2VyXHJcbiAqL1xyXG5jb25zdCBzZXJ2aWNlV29ya2VyID0gKCkgPT4ge1xyXG4gIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHJldHVybjtcclxuXHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXJcclxuICAgIC5yZWdpc3RlcignL3NlcnZpY2Utd29ya2VyLmpzJywgeyBzY29wZTogJy8nIH0pXHJcbiAgICAudGhlbihyZWcgPT4ge1xyXG4gICAgICBpZiAobG9nZ2luZykgY29uc29sZS5sb2coJ1tTZXJ2aWNlV29ya2VyXSByZWdpc3RlcmVkJyk7XHJcbiAgICAgIC8vIGlmIChyZWcud2FpdGluZykge1xyXG4gICAgICAvLyAgIGNvbnNvbGUubG9nKCdbU2VydmljZVdvcmtlcl0gdXBkYXRlZCB2ZXJzaW9uIGlzIHJlYWR5IHRvIGJlIGluc3RhbGxlZCcpO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIC8vIGlmIChyZWcuaW5zdGFsbGluZykge1xyXG4gICAgICAvLyAgIGNvbnNvbGUubG9nKCdbU2VydmljZVdvcmtlcl0gdXBkYXRlZCB2ZXJzaW9uIGlzIGluc3RhbGxpbmcnKTtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyByZWcuYWRkRXZlbnRMaXN0ZW5lcigndXBkYXRlZm91bmQnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgIC8vICAgY29uc29sZS5sb2coJ1tTZXJ2aWNlV29ya2VyXSBuZXcgU2VydmljZVdvcmtlciBhcnJpdmFsJyk7XHJcbiAgICAgIC8vIH0pO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coJ1tTZXJ2aWNlV29ya2VyXSByZWdpc3RyYXRpb24gZmFpbGVkIScsIGVycikpO1xyXG59O1xyXG4iXX0=
