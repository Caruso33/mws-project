"use strict";var map,restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[],lazyImages=[],logging=!1;document.addEventListener("DOMContentLoaded",function(e){serviceWorker(),fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){window.localforage.getItem("restaurantData",function(e,t){t?self.restaurantList=t:DBHelper.fetchNeighborhoods(function(e,t){e||(self.neighborhoods=t,fillNeighborhoodsHTML())})})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e||(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1});google.maps.event.addListenerOnce(self.map,"idle",function(){var e=document.querySelector("iframe");e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex","-1")});updateRestaurants()};var updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,s=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,s,function(e,t){e||(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap(),lazyLoadImages()},createRestaurantHTML=function(e){var t=document.createElement("li"),n=document.createElement("figure"),r=document.createElement("img"),a=document.createElement("figcaption");n.className="restaurant-fig",r.className="restaurant-img",a.className="restaurant-figcap";var s=DBHelper.imageUrlForRestaurant(e);r.src="",r.alt="An impression of restaurant "+e.name,a.innerHTML="Restaurant "+e.name;var i=s.slice(0,-17);r["data-src"]=i+".webp",r["data-srcset"]=i+"-250_small-min.webp 250w,\n                  "+i+"-400_medium-min.webp 400w",r.sizes="(min-width: 434px) 300px, calc(100% - 137px)",n.append(r),n.append(a),t.append(n);var o=document.createElement("h2");o.innerHTML=e.name,t.append(o);var c=document.createElement("p");c.innerHTML=e.neighborhood,t.append(c);var u=document.createElement("p");u.innerHTML=e.address,t.append(u);var l=document.createElement("a");return l.innerHTML="View Details",l.href=DBHelper.urlForRestaurant(e),l.setAttribute("role","button"),l.setAttribute("aria-label","Press to view details of restaurant "+e.name),t.append(l),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},lazyLoadImages=function(){var e=[].slice.call(document.querySelectorAll(".restaurant-img"));if("IntersectionObserver"in window){var n=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){var t=e.target;t.src=t["data-src"],t.srcset=t["data-srcset"],n.unobserve(t)}})});e.forEach(function(e){n.observe(e)})}},serviceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){}).catch(function(e){})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInNlcnZpY2VXb3JrZXIiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJ3aW5kb3ciLCJsb2NhbGZvcmFnZSIsImdldEl0ZW0iLCJlcnIiLCJyZXN0YXVyYW50TGlzdCIsIkRCSGVscGVyIiwiZXJyb3IiLCJzZWxmIiwiY29uc29sZSIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsIm5laWdoYm9yaG9vZCIsImNyZWF0ZUVsZW1lbnQiLCJvcHRpb24iLCJ2YWx1ZSIsImZldGNoQ3Vpc2luZXMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwiY3Vpc2luZSIsImFwcGVuZCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJ6b29tIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJhZGRMaXN0ZW5lck9uY2UiLCJjZW50ZXIiLCJxdWVyeVNlbGVjdG9yIiwiaWZyYW1lIiwic2V0QXR0cmlidXRlIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInVsIiwiaW5uZXJIVE1MIiwibWFya2VycyIsInNldE1hcCIsIm0iLCJyZXN0YXVyYW50IiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJsaSIsImZpZ2NhcCIsImZpZyIsImltYWdlIiwiY2xhc3NOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwibmFtZSIsInBsYWNlaG9sZGVySW1nIiwic2xpY2UiLCJyYXdJbWciLCJzaXplcyIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsInB1c2giLCJsYXp5TG9hZEltYWdlcyIsImxhenlJbWFnZXMiLCJjYWxsIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwib2JzZXJ2ZXIiLCJsYXp5SW1hZ2UiLCJzcmNzZXQiLCJsYXp5SW1hZ2VPYnNlcnZlciIsInVub2JzZXJ2ZSIsImVudHJ5IiwidGFyZ2V0Iiwic3JjIiwib2JzZXJ2ZSIsIm5hdmlnYXRvciIsInJlZ2lzdGVyIiwic2NvcGUiLCJ0aGVuIiwicmVnIiwiY2F0Y2giXSwibWFwcGluZ3MiOiJBQUFBLGFBQ0EsSUFBSUEsSUFBQUEsaUJBQUFBLEVBQWFDLG1CQUFBQSxFQUFlQyxjQUFBQSxFQUFmRCxRQUFBQSxHQUFlQyxXQUFBQSxHQUM1QkMsU0FBSixFQUtBQyxTQUFBQyxpQkFBQSxtQkFBQSxTQUFBQyxHQUlFQyxnQkFDQUMscUJBRkZKLGtCQU1BLElBQUFJLG1CQUFBLFdBSUVDLE9BQU9DLFlBQVlDLFFBQVEsaUJBQWtCLFNBQVNDLEVBQUtDLEdBQ3JEQSxFQUZGTCxLQUFBQSxlQUFxQkssRUFFdkJDLFNBQUlELG1CQUFnQixTQUFBRSxFQUFBZCxHQUNiWSxJQUlERyxLQUFBZixjQUFBQSxFQUNBZ0IsOEJBVVZDLHNCQUFBLFdBQUEsSUFBQWpCLEVBQUEsRUFBQWtCLFVBQUFDLGFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFBSCxLQUFBZixjQUlRcUIsRUFBU2xCLFNBQVNtQixlQUFlLHdCQUN2Q3RCLEVBQWN1QixRQUFRLFNBQUFDLEdBRmxCUCxJQUFBQSxFQUFBQSxTQUF3QlEsY0FBeEJSLFVBQWdFUyxFQUF2QzFCLFVBQXVDd0IsRUFLbEVFLEVBQU9DLE1BQVFILEVBSmpCSCxFQUFNQSxPQUFTbEIsTUFEakJ5QixjQUFBLFdBY0VmLFNBQVNlLGNBQWMsU0FBQ2QsRUFBT2Is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TSxTQUFBdkYiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxubGV0IHJlc3RhdXJhbnRzLCBuZWlnaGJvcmhvb2RzLCBjdWlzaW5lcztcclxudmFyIG1hcDtcclxudmFyIG1hcmtlcnMgPSBbXTtcclxudmFyIGxhenlJbWFnZXMgPSBbXTtcclxuY29uc3QgbG9nZ2luZyA9IGZhbHNlO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGV2ZW50ID0+IHtcclxuICBzZXJ2aWNlV29ya2VyKCk7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgd2luZG93LmxvY2FsZm9yYWdlLmdldEl0ZW0oJ3Jlc3RhdXJhbnREYXRhJywgZnVuY3Rpb24oZXJyLCByZXN0YXVyYW50TGlzdCkge1xyXG4gICAgaWYgKHJlc3RhdXJhbnRMaXN0KSB7XHJcbiAgICAgIHNlbGYucmVzdGF1cmFudExpc3QgPSByZXN0YXVyYW50TGlzdDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgIC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICB6b29tOiAxMixcclxuICAgIGNlbnRlcjogbG9jLFxyXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgfSk7XHJcbiAgY29uc3QgaWRsZUxpc3RlbmVyID0gZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXJPbmNlKFxyXG4gICAgc2VsZi5tYXAsXHJcbiAgICAnaWRsZScsXHJcbiAgICAoKSA9PiB7XHJcbiAgICAgIGxldCBpZnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTtcclxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xyXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xyXG4gICAgfVxyXG4gICk7XHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxuY29uc3QgdXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoXHJcbiAgICBjdWlzaW5lLFxyXG4gICAgbmVpZ2hib3Job29kLFxyXG4gICAgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHMgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxuICBsYXp5TG9hZEltYWdlcygpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jb25zdCBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IHJlc3RhdXJhbnQgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHJcbiAgY29uc3QgZmlnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBjb25zdCBmaWdjYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWdjYXB0aW9uJyk7XHJcblxyXG4gIGZpZy5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1maWcnO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgZmlnY2FwLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWZpZ2NhcCc7XHJcblxyXG4gIGNvbnN0IHBsYWNlaG9sZGVySW1nID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLnNyYyA9ICcnO1xyXG4gIGltYWdlLmFsdCA9IGBBbiBpbXByZXNzaW9uIG9mIHJlc3RhdXJhbnQgJHtyZXN0YXVyYW50Lm5hbWV9YDtcclxuICBmaWdjYXAuaW5uZXJIVE1MID0gYFJlc3RhdXJhbnQgJHtyZXN0YXVyYW50Lm5hbWV9YDtcclxuXHJcbiAgLy8gc3Jjc2V0OiBzZXJ2aW5nIHRoZSByaWdodCBpbWcgc2l6ZSB0byB0aGUgcmlnaHQgdmlld3BvcnQgd2lkdGhcclxuICBjb25zdCByYXdJbWcgPSBwbGFjZWhvbGRlckltZy5zbGljZSgwLCAtMTcpO1xyXG4gIGltYWdlWydkYXRhLXNyYyddID0gYCR7cmF3SW1nfS53ZWJwYDtcclxuICBpbWFnZVsnZGF0YS1zcmNzZXQnXSA9IGAke3Jhd0ltZ30tMjUwX3NtYWxsLW1pbi53ZWJwIDI1MHcsXHJcbiAgICAgICAgICAgICAgICAgICR7cmF3SW1nfS00MDBfbWVkaXVtLW1pbi53ZWJwIDQwMHdgO1xyXG4gIGltYWdlLnNpemVzID0gYChtaW4td2lkdGg6IDQzNHB4KSAzMDBweCwgY2FsYygxMDAlIC0gMTM3cHgpYDtcclxuXHJcbiAgZmlnLmFwcGVuZChpbWFnZSk7XHJcbiAgZmlnLmFwcGVuZChmaWdjYXApO1xyXG4gIGxpLmFwcGVuZChmaWcpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBsaS5hcHBlbmQobmFtZSk7XHJcblxyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XHJcbiAgbGkuYXBwZW5kKG5laWdoYm9yaG9vZCk7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XHJcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBtb3JlLnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcclxuICBtb3JlLnNldEF0dHJpYnV0ZShcclxuICAgICdhcmlhLWxhYmVsJyxcclxuICAgIGBQcmVzcyB0byB2aWV3IGRldGFpbHMgb2YgcmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX1gXHJcbiAgKTtcclxuXHJcbiAgbGkuYXBwZW5kKG1vcmUpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmNvbnN0IGFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmw7XHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn07XHJcbi8vIExhenkgbG9hZGluZyBmb3IgaW1hZ2VzIGFzIGZyb206XHJcbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3dlYi9mdW5kYW1lbnRhbHMvcGVyZm9ybWFuY2UvbGF6eS1sb2FkaW5nLWd1aWRhbmNlL2ltYWdlcy1hbmQtdmlkZW8vXHJcbmNvbnN0IGxhenlMb2FkSW1hZ2VzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGxhenlJbWFnZXMgPSBbXS5zbGljZS5jYWxsKFxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlc3RhdXJhbnQtaW1nJylcclxuICApO1xyXG4gIGlmICgnSW50ZXJzZWN0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xyXG4gICAgbGV0IGxhenlJbWFnZU9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGZ1bmN0aW9uKFxyXG4gICAgICBlbnRyaWVzLFxyXG4gICAgICBvYnNlcnZlclxyXG4gICAgKSB7XHJcbiAgICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XHJcbiAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XHJcbiAgICAgICAgICBsZXQgbGF6eUltYWdlID0gZW50cnkudGFyZ2V0O1xyXG4gICAgICAgICAgbGF6eUltYWdlLnNyYyA9IGxhenlJbWFnZVsnZGF0YS1zcmMnXTtcclxuICAgICAgICAgIGxhenlJbWFnZS5zcmNzZXQgPSBsYXp5SW1hZ2VbJ2RhdGEtc3Jjc2V0J107XHJcbiAgICAgICAgICBsYXp5SW1hZ2VPYnNlcnZlci51bm9ic2VydmUobGF6eUltYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbGF6eUltYWdlcy5mb3JFYWNoKGxhenlJbWFnZSA9PiB7XHJcbiAgICAgIGxhenlJbWFnZU9ic2VydmVyLm9ic2VydmUobGF6eUltYWdlKTtcclxuICAgIH0pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zb2xlLmxvZygnTGF6eUxvYWRJbWFnZXMgZmFpbGVkJyk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gY29uc3QgbGF6eUxvYWRHb29nbGVNYXAgPSAoKSA9PiB7XHJcbi8vICAgY29uc3QgbGF6eU1hcCA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI21hcCcpKTtcclxuLy9cclxuLy8gICBpZiAoJ0ludGVyc2VjdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpIHtcclxuLy8gICAgIGxldCBsYXp5R29vZ2xlTWFwT2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24oXHJcbi8vICAgICAgIGVudHJpZXMsXHJcbi8vICAgICAgIG9ic2VydmVyXHJcbi8vICAgICApIHtcclxuLy8gICAgICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcclxuLy8gICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcclxuLy8gICAgICAgICAgIGxldCBsYXp5R29vZ2xlTWFwID0gZW50cnkudGFyZ2V0O1xyXG4vLyAgICAgICAgICAgaW5pdGlhbGl6ZU1hcCgpO1xyXG4vLyAgICAgICAgICAgbGF6eU1hcE9ic2VydmVyLnVub2JzZXJ2ZShsYXp5R29vZ2xlTWFwKTtcclxuLy8gICAgICAgICB9XHJcbi8vICAgICAgIH0pO1xyXG4vLyAgICAgfSk7XHJcbi8vICAgICBsYXp5TWFwLmZvckVhY2gobWFwID0+IHtcclxuLy8gICAgICAgbGF6eU1hcE9ic2VydmVyLm9ic2VydmUobWFwKTtcclxuLy8gICAgIH0pO1xyXG4vLyAgIH0gZWxzZSB7XHJcbi8vICAgICAvLyBQb3NzaWJseSBmYWxsIGJhY2sgdG8gYSBtb3JlIGNvbXBhdGlibGUgbWV0aG9kIGhlcmVcclxuLy8gICAgIGNvbnNvbGUubG9nKCdMYXp5TG9hZEdvb2dsZU1hcHMgZmFpbGVkJyk7XHJcbi8vICAgfVxyXG4vLyB9O1xyXG5cclxuLyoqXHJcbiAqIEFkZCBzZXJ2aWNlLXdvcmtlclxyXG4gKi9cclxuY29uc3Qgc2VydmljZVdvcmtlciA9ICgpID0+IHtcclxuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcblxyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyXHJcbiAgICAucmVnaXN0ZXIoJy9zZXJ2aWNlLXdvcmtlci5qcycsIHsgc2NvcGU6ICcvJyB9KVxyXG4gICAgLnRoZW4ocmVnID0+IHtcclxuICAgICAgaWYgKGxvZ2dpbmcpIGNvbnNvbGUubG9nKCdbU2VydmljZVdvcmtlcl0gcmVnaXN0ZXJlZCcpO1xyXG4gICAgICAvLyBpZiAocmVnLndhaXRpbmcpIHtcclxuICAgICAgLy8gICBjb25zb2xlLmxvZygnW1NlcnZpY2VXb3JrZXJdIHVwZGF0ZWQgdmVyc2lvbiBpcyByZWFkeSB0byBiZSBpbnN0YWxsZWQnKTtcclxuICAgICAgLy8gfVxyXG4gICAgICAvLyBpZiAocmVnLmluc3RhbGxpbmcpIHtcclxuICAgICAgLy8gICBjb25zb2xlLmxvZygnW1NlcnZpY2VXb3JrZXJdIHVwZGF0ZWQgdmVyc2lvbiBpcyBpbnN0YWxsaW5nJyk7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gcmVnLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAvLyAgIGNvbnNvbGUubG9nKCdbU2VydmljZVdvcmtlcl0gbmV3IFNlcnZpY2VXb3JrZXIgYXJyaXZhbCcpO1xyXG4gICAgICAvLyB9KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKCdbU2VydmljZVdvcmtlcl0gcmVnaXN0cmF0aW9uIGZhaWxlZCEnLCBlcnIpKTtcclxufTtcclxuIl19
